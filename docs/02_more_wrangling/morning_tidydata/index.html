<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-04-06 Tue 20:54 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tidy data</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../../css/my_css.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../../index.html"> UP </a>
 |
 <a accesskey="H" href="../../index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Tidy data</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org38eda07">Tidy data</a>
<ul>
<li><a href="#org4e7fed9">Introduction: What is tidy data?</a></li>
<li><a href="#org8868820">Tidy tools: Why you should care about tidy data</a></li>
<li><a href="#org30f7b83">Example: Deriving a tidy table of babynames with <code>distinct()</code></a>
<ul>
<li><a href="#org93870ad"><b>Exercise</b> (optional) with <code>distinct()</code></a></li>
</ul>
</li>
<li><a href="#org28003ad">The <code>tidyr</code> package: going from wide to long and back again</a>
<ul>
<li><a href="#orgb375989"><b>Exercises</b></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org6c1eb23">Combining information across tables: <code>dplyr</code> two-table verbs</a>
<ul>
<li><a href="#org4337fac">Mutating joins</a>
<ul>
<li><a href="#orge06a762"><code>inner_join()</code></a></li>
<li><a href="#orgec93d8e"><code>left_join()</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgca987b0"></a></li>
</ul>
</div>
</div>

<div id="outline-container-org38eda07" class="outline-2">
<h2 id="org38eda07">Tidy data</h2>
<div class="outline-text-2" id="text-org38eda07">
</div>
<div id="outline-container-org4e7fed9" class="outline-3">
<h3 id="org4e7fed9">Introduction: What is tidy data?</h3>
<div class="outline-text-3" id="text-org4e7fed9">
<blockquote>
<p>
&ldquo;Happy families are all alike; every unhappy family is unhappy in its own way.&rdquo; -Tolstoy
</p>
</blockquote>

<p>
This <a href="http://vita.had.co.nz/papers/tidy-data.html">influential paper by Hadley Wickham</a> introduces the notion of tidy data. In this section, we will learn the basic principles of tidy data, why it is important, and what tools you need to get your data into tidy format.
</p>

<p>
Tidy datasets conform to <b>a standarized way of linking data structure to data semantics (meaning)</b> based on the following three principles:
</p>

<ol class="org-ol">
<li>Each variable forms a column</li>
<li>Each observation forms a row</li>
<li>Each type of observational unit forms a table</li>
</ol>

<p>
These principles are best illustrated by example.
</p>

<p>
Consider the dataset below, corresponding to an imaginary two-alternative forced choice lexical decision study, where you present four word stimuli in a row to each participant, with each stimulus being in one of two conditions (<code>Cond</code>: control, <code>C</code> or experimental, <code>E</code>) and you record response time (<code>RT</code> in milliseconds) and the participant&rsquo;s choice (<code>Choice</code>: <code>A</code> or <code>B</code>).  Here is an untidy representation of the data.
</p>


<div class="figure">
<p><img src="untidy.png" alt="untidy.png" />
</p>
<p><span class="figure-number">Figure 1: </span>Untidy representation.</p>
</div>

<p>
If you think about the variables in the study&#x2014; <code>Cond</code>, <code>RT</code>, <code>Choice</code>, <code>SubjectID</code> &#x2014; this representation is clearly <i>untidy</i>.  The person who entered the data did it in such a way that they squeezed all of the observations for a single subject into one row.
</p>

<p>
Tidyness can be a matter of degree.  Here is a more tidy version of the dataset.  This is better, but can you see the way that it is untidy?
</p>


<div class="figure">
<p><img src="tidyish.png" alt="tidyish.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Tidy-ish representation.</p>
</div>


<div class='solution'><button>Solution</button>

<p>
This table violates the third principle; multiple observation units are represented in a single table.
</p>


</div>

<p>
The observation units in this study can be broken down to Subject and Trial (and even Item, if we have information about each stimulus, such as whether it is high or low frequency).  Breaking these apart into separate tables eliminates redundancy.
</p>


<div class="figure">
<p><img src="tidy.png" alt="tidy.png" />
</p>
<p><span class="figure-number">Figure 3: </span>Tidy representation.</p>
</div>
</div>
</div>

<div id="outline-container-org8868820" class="outline-3">
<h3 id="org8868820">Tidy tools: Why you should care about tidy data</h3>
<div class="outline-text-3" id="text-org8868820">
<p>
The tidy format is a clean, predictable data structure. We don&rsquo;t just make our data tidy because it looks nice, but because having tidy data allows us to work with <b>tidy tools</b>.  A <b>tidy tool</b> is a function to transform data that takes tidy data as input and returns tidy data as output.  All of the functions in the <code>tidyverse</code> packages have been designed as tidy tools, and thus are interoperable. In contrast, many of the older functions in base R do not yield tidy output, which impaires interoperability.
</p>
</div>
</div>

<div id="outline-container-org30f7b83" class="outline-3">
<h3 id="org30f7b83">Example: Deriving a tidy table of babynames with <code>distinct()</code></h3>
<div class="outline-text-3" id="text-org30f7b83">
<p>
Let&rsquo;s imagine you are a linguist interested in whether trends in babynames have a phonological basis; for example, do girls names ending with a vowel become popular at certain times in history?  You would need to derive information about the sound properties of each name in the babynames dataset.  A good place to start would be to derive a table containing all of the unique names in the dataset; once you&rsquo;ve created the table then you could fill in the table with additional information, and later recombine it with the popularity data.  The <code>distinct()</code> function is the function you need to do this.
</p>

<div class="org-src-container">
<pre class="src src-R">name_table <span style="font-weight: bold; text-decoration: underline;">&lt;-</span> babynames <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span> distinct(name) <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span> arrange(name)

name_table
</pre>
</div>

<pre class="example">

# A tibble: 97,310 x 1
   name     
   &lt;chr&gt;    
 1 Aaban    
 2 Aabha    
 3 Aabid    
 4 Aabir    
 5 Aabriella
 6 Aada     
 7 Aadam    
 8 Aadan    
 9 Aadarsh  
10 Aaden    
# … with 97,300 more rows
</pre>

<p>
Now <code>name_table</code> is a table of the <code class="src src-R">nrow(name_table)</code> <code>[1] 97310</code> distinct names in the dataset.  Let&rsquo;s determine whether the name ends with a vowel using the <code>substr()</code> function, which extracts a substring from a character value.
</p>

<div class="org-src-container">
<pre class="src src-R">name_table <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  mutate(end_char = substr(name, nchar(name), nchar(name)),
         is_vowel = end_char <span style="font-weight: bold; text-decoration: underline;">%in%</span> c(<span style="font-style: italic;">"a"</span>, <span style="font-style: italic;">"e"</span>, <span style="font-style: italic;">"i"</span>, <span style="font-style: italic;">"o"</span>, <span style="font-style: italic;">"u"</span>))
</pre>
</div>

<pre class="example">

# A tibble: 97,310 x 3
   name      end_char is_vowel
   &lt;chr&gt;     &lt;chr&gt;    &lt;lgl&gt;   
 1 Aaban     n        FALSE   
 2 Aabha     a        TRUE    
 3 Aabid     d        FALSE   
 4 Aabir     r        FALSE   
 5 Aabriella a        TRUE    
 6 Aada      a        TRUE    
 7 Aadam     m        FALSE   
 8 Aadan     n        FALSE   
 9 Aadarsh   h        FALSE   
10 Aaden     n        FALSE   
# … with 97,300 more rows
</pre>

<p>
You could add further linguistic information into this table (e.g., number of syllables, etc.). Later on we will learn how you could re-combine this back with the original table using an <code>inner_join()</code>.
</p>
</div>

<div id="outline-container-org93870ad" class="outline-4">
<h4 id="org93870ad"><b>Exercise</b> (optional) with <code>distinct()</code></h4>
<div class="outline-text-4" id="text-org93870ad">
<p>
Create a table containing the distinct names for each sex in the table. (Note that you can use more than one argument to <code>distinct()</code>.)  Then pull out those names that are <b>not</b> androgynous, i.e., that <b>only</b> appear for boys and never for girls, or vice versa.
</p>


<div class='solution'><button>Hint</button>

<p>
you can use a windowed operation with <code>group_by()</code>
</p>


</div>

<div class='solution'><button>Solution</button>

<div class="org-src-container">
<pre class="src src-R">distinct(babynames, name, sex) <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  group_by(name) <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  filter(n() == 1)

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">alternative solution:</span>
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">distinct(babynames, name, sex) %&gt;%</span>
<span style="font-weight: bold; font-style: italic;">##   </span><span style="font-weight: bold; font-style: italic;">count(name) %&gt;%</span>
<span style="font-weight: bold; font-style: italic;">##   </span><span style="font-weight: bold; font-style: italic;">filter(n == 1)</span>
</pre>
</div>

<pre class="example">

# A tibble: 86,647 x 2
# Groups:   name [86,647]
   sex   name    
   &lt;chr&gt; &lt;chr&gt;   
 1 F     Lulu    
 2 F     Belle   
 3 F     Mayme   
 4 F     Mathilda
 5 F     Hettie  
 6 F     Fanny   
 7 F     Adelaide
 8 F     Lelia   
 9 F     Nelle   
10 F     Minerva 
# … with 86,637 more rows
</pre>

</div>
</div>
</div>
</div>

<div id="outline-container-org28003ad" class="outline-3">
<h3 id="org28003ad">The <code>tidyr</code> package: going from wide to long and back again</h3>
<div class="outline-text-3" id="text-org28003ad">
<p>
The <a href="https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf">RStudio Data Import cheatsheet</a> may be useful for this part of the session.  Here is the key part of that cheatsheet that explains what we&rsquo;ll be learning.
</p>


<div class="figure">
<p><img src="tidying.png" alt="tidying.png" />
</p>
</div>

<p>
The examples in the figure above are available to your session through the <code>tidyr</code> package.  Try them out in the console so that you get an understanding of how they work.
</p>

<p>
The dataset we will be working with in the file <a href="personality.csv"><code>personality.csv</code></a>.  The dataset is from a 5-factor (OCEAN) personality questionnaire (thanks to Lisa DeBruine). Each question is labelled with the domain (Op = openness, Co = concientiousness, Ex = extraversion, Ag = agreeableness, and Ne = neuroticism) and the question number.
</p>
</div>

<div id="outline-container-orgb375989" class="outline-4">
<h4 id="orgb375989"><b>Exercises</b></h4>
<div class="outline-text-4" id="text-orgb375989">
</div>
<ul class="org-ul">
<li><a id="org3b55ca3"></a>Load and look!<br />
<div class="outline-text-5" id="text-org3b55ca3">
<p>
Load in the data from the csv file into the variable <code>big5</code> and look at it (use <code>glimpse()</code> and <code>View()</code>).
</p>

<div class='solution'><button>Solution</button>

<div class="org-src-container">
<pre class="src src-R">big5 <span style="font-weight: bold; text-decoration: underline;">&lt;-</span> read_csv(<span style="font-style: italic;">"personality.csv"</span>)
glimpse(big5)
</pre>
</div>

<pre class="example">

── Column specification ────────────────────────────────────────────────────────
cols(
  .default = col_double(),
  date = col_date(format = "")
)
ℹ Use `spec()` for the full column specifications.

Rows: 15,000
Columns: 43
$ user_id &lt;dbl&gt; 0, 1, 2, 5, 8, 108, 233, 298, 426, 436, 685, 807, 871, 881, 94…
$ date    &lt;date&gt; 2006-03-23, 2006-02-08, 2005-10-24, 2005-12-07, 2006-07-27, 2…
$ Op1     &lt;dbl&gt; 3, 6, 6, 6, 6, 3, 3, 6, 6, 3, 4, 5, 5, 5, 6, 4, 1, 2, 5, 6, 4,…
$ Ne1     &lt;dbl&gt; 4, 0, 0, 4, 1, 2, 3, 4, 0, 3, 3, 3, 2, 1, 1, 3, 4, 5, 2, 4, 5,…
$ Ne2     &lt;dbl&gt; 0, 6, 6, 4, 2, 1, 2, 3, 1, 2, 5, 5, 3, 1, 1, 1, 1, 6, 1, 2, 5,…
$ Op2     &lt;dbl&gt; 6, 0, 0, 4, 6, 4, 4, 0, 0, 3, 4, 3, 3, 4, 5, 3, 3, 4, 1, 6, 6,…
$ Ex1     &lt;dbl&gt; 3, 0, 0, 2, 2, 4, 4, 3, 5, 4, 1, 1, 3, 3, 1, 3, 5, 1, 0, 4, 1,…
$ Ex2     &lt;dbl&gt; 3, 0, 0, 3, 3, 4, 5, 2, 5, 3, 4, 1, 3, 2, 1, 6, 5, 3, 4, 4, 1,…
$ Co1     &lt;dbl&gt; 3, 0, 0, 3, 5, 4, 3, 4, 5, 3, 3, 3, 1, 5, 5, 4, 4, 5, 6, 4, 2,…
$ Co2     &lt;dbl&gt; 3, 0, 0, 3, 4, 3, 3, 4, 5, 3, 5, 3, 3, 4, 5, 1, 5, 4, 5, 2, 5,…
$ Ne3     &lt;dbl&gt; 0, 0, 0, 1, 0, 1, 4, 4, 0, 4, 2, 5, 1, 2, 5, 5, 2, 2, 1, 2, 5,…
$ Ag1     &lt;dbl&gt; 2, 0, 0, 4, 6, 5, 5, 4, 2, 5, 4, 3, 2, 4, 5, 3, 5, 5, 5, 4, 4,…
$ Ag2     &lt;dbl&gt; 1, 6, 6, 0, 5, 4, 5, 3, 4, 3, 5, 1, 5, 4, 2, 6, 5, 5, 5, 5, 2,…
$ Ne4     &lt;dbl&gt; 3, 6, 6, 2, 3, 2, 3, 3, 0, 4, 4, 5, 5, 4, 5, 3, 2, 5, 2, 4, 5,…
$ Ex3     &lt;dbl&gt; 3, 6, 5, 5, 3, 3, 3, 0, 6, 1, 4, 2, 3, 2, 1, 2, 5, 1, 0, 5, 5,…
$ Co3     &lt;dbl&gt; 2, 0, 1, 3, 4, 4, 5, 4, 5, 3, 4, 3, 4, 4, 5, 4, 2, 4, 5, 2, 2,…
$ Op3     &lt;dbl&gt; 2, 6, 5, 5, 5, 4, 3, 2, 4, 3, 3, 6, 5, 5, 6, 5, 4, 4, 3, 6, 5,…
$ Ex4     &lt;dbl&gt; 1, 0, 1, 3, 3, 3, 4, 3, 5, 3, 2, 0, 3, 3, 1, 2, NA, 4, 4, 4, 1…
$ Op4     &lt;dbl&gt; 3, 0, 1, 6, 6, 3, 3, 0, 6, 3, 4, 5, 4, 5, 6, 6, 2, 2, 4, 5, 5,…
$ Ex5     &lt;dbl&gt; 3, 0, 1, 6, 3, 3, 4, 2, 5, 2, 2, 4, 2, 3, 0, 4, 5, 2, 3, 1, 1,…
$ Ag3     &lt;dbl&gt; 1, 0, 1, 1, 0, 4, 4, 4, 3, 3, 4, 4, 3, 4, 4, 5, 5, 4, 5, 3, 4,…
$ Co4     &lt;dbl&gt; 3, 6, 5, 5, 5, 3, 2, 4, 3, 1, 4, 3, 1, 2, 4, 2, NA, 5, 6, 1, 1…
$ Co5     &lt;dbl&gt; 0, 6, 5, 5, 5, 3, 3, 1, 5, 1, 2, 4, 4, 4, 2, 1, 6, 4, 3, 1, 3,…
$ Ne5     &lt;dbl&gt; 3, 0, 1, 4, 1, 1, 4, 5, 0, 3, 4, 6, 2, 0, 1, 1, 0, 4, 3, 1, 5,…
$ Op5     &lt;dbl&gt; 6, 6, 5, 2, 5, 4, 3, 2, 6, 6, 2, 4, 3, 4, 6, 6, 6, 5, 3, 3, 5,…
$ Ag4     &lt;dbl&gt; 1, 0, 1, 4, 6, 5, 5, 6, 6, 6, 4, 2, 4, 5, 4, 5, 6, 4, 5, 6, 5,…
$ Op6     &lt;dbl&gt; 0, 6, 5, 1, 6, 4, 6, 0, 0, 3, 5, 3, 5, 5, 5, 2, 5, 1, 1, 6, 2,…
$ Co6     &lt;dbl&gt; 6, 0, 1, 4, 6, 5, 6, 5, 4, 3, 5, 5, 4, 6, 6, 1, 3, 4, 5, 4, 6,…
$ Ex6     &lt;dbl&gt; 3, 6, 5, 3, 0, 4, 3, 1, 6, 3, 2, 1, 4, 2, 1, 5, 6, 2, 1, 2, 1,…
$ Ne6     &lt;dbl&gt; 1, 6, 5, 1, 0, 1, 3, 4, 0, 4, 4, 5, 2, 1, 5, 6, 1, 2, 2, 3, 5,…
$ Co7     &lt;dbl&gt; 3, 6, 5, 1, 3, 4, NA, 2, 3, 3, 2, 2, 4, 2, 5, 2, 5, 5, 3, 1, 1…
$ Ag5     &lt;dbl&gt; 3, 6, 5, 0, 2, 5, 6, 2, 2, 3, 4, 1, 3, 5, 2, 6, 5, 6, 5, 3, 3,…
$ Co8     &lt;dbl&gt; 3, 0, 1, 1, 3, 4, 3, 0, 1, 3, 2, 2, 1, 2, 4, 3, 2, 4, 5, 2, 6,…
$ Ex7     &lt;dbl&gt; 3, 6, 5, 4, 1, 2, 5, 3, 6, 3, 4, 3, 5, 1, 1, 6, 6, 3, 1, 1, 3,…
$ Ne7     &lt;dbl&gt; NA, 0, 1, 2, 0, 2, 4, 4, 0, 3, 2, 5, 1, 2, 5, 2, 2, 4, 1, 3, 5…
$ Co9     &lt;dbl&gt; 3, 6, 5, 4, 3, 4, 5, 3, 5, 3, 4, 3, 4, 4, 2, 4, 6, 5, 5, 2, 2,…
$ Op7     &lt;dbl&gt; 0, 6, 5, 5, 5, 4, 6, 2, 1, 3, 2, 4, 5, 5, 6, 3, 6, 5, 2, 6, 5,…
$ Ne8     &lt;dbl&gt; 2, 0, 1, 1, 1, 1, 5, 4, 0, 4, 4, 5, 1, 2, 5, 2, 1, 5, 1, 2, 5,…
$ Ag6     &lt;dbl&gt; NA, 6, 5, 2, 3, 4, 5, 6, 1, 3, 4, 2, 3, 5, 1, 6, 2, 6, 6, 5, 3…
$ Ag7     &lt;dbl&gt; 3, 0, 1, 1, 1, 3, 3, 5, 0, 3, 2, 1, 2, 3, 5, 6, 4, 4, 6, 6, 2,…
$ Co10    &lt;dbl&gt; 1, 6, 5, 5, 3, 5, 1, 2, 5, 2, 4, 3, 4, 4, 3, 2, 5, 5, 5, 2, 2,…
$ Ex8     &lt;dbl&gt; 2, 0, 1, 4, 3, 4, 2, 4, 6, 2, 4, 0, 4, 4, 1, 3, 5, 4, 3, 1, 1,…
$ Ex9     &lt;dbl&gt; 4, 6, 5, 5, 5, 2, 3, 3, 6, 3, 3, 4, 4, 3, 2, 5, 5, 4, 4, 0, 4,…
</pre>

</div>
</div>
</li>

<li><a id="org25d6932"></a>Reshape from wide to long<br />
<div class="outline-text-5" id="text-org25d6932">
<p>
The dataset is in wide format. Use the appropriate tidyr function to reshape it to long, with variables named <code>item</code> (which item, <code>Op1</code>, <code>Ne1</code>, etc) and <code>score</code> (3, 4, 0, 6, etc).  Store the long data in the variable <code>big5_long</code>
</p>

<div class='solution'><button>Solution</button>

<div class="org-src-container">
<pre class="src src-R">big5_long <span style="font-weight: bold; text-decoration: underline;">&lt;-</span> pivot_longer(big5, Op1:Ex9,
                          names_to = <span style="font-style: italic;">"item"</span>, values_to = <span style="font-style: italic;">"score"</span>)  

big5_long
</pre>
</div>

<pre class="example">

# A tibble: 615,000 x 4
   user_id date       item  score
     &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt; &lt;dbl&gt;
 1       0 2006-03-23 Op1       3
 2       0 2006-03-23 Ne1       4
 3       0 2006-03-23 Ne2       0
 4       0 2006-03-23 Op2       6
 5       0 2006-03-23 Ex1       3
 6       0 2006-03-23 Ex2       3
 7       0 2006-03-23 Co1       3
 8       0 2006-03-23 Co2       3
 9       0 2006-03-23 Ne3       0
10       0 2006-03-23 Ag1       2
# … with 614,990 more rows
</pre>

</div>
</div>
</li>

<li><a id="org85a74a2"></a>Split the <code>item</code> variable into two variables<br />
<div class="outline-text-5" id="text-org85a74a2">
<p>
Try to use the <code>separate()</code> function to make your table look like this:
</p>

<pre class="example">

# A tibble: 615,000 x 5
   user_id date       trait question score
     &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt;
 1       0 2006-03-23 Op           1     3
 2       0 2006-03-23 Ne           1     4
 3       0 2006-03-23 Ne           2     0
 4       0 2006-03-23 Op           2     6
 5       0 2006-03-23 Ex           1     3
 6       0 2006-03-23 Ex           2     3
 7       0 2006-03-23 Co           1     3
 8       0 2006-03-23 Co           2     3
 9       0 2006-03-23 Ne           3     0
10       0 2006-03-23 Ag           1     2
# … with 614,990 more rows
</pre>

<p>
See <code>?separate</code> to find out what argument you need to use to be able to separate based on position (rather than character).  Store the result in <code>big5_long2</code>.
</p>

<div class='solution'><button>Solution</button>

<div class="org-src-container">
<pre class="src src-R">big5_long2 <span style="font-weight: bold; text-decoration: underline;">&lt;-</span> big5_long <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  separate(item, c(<span style="font-style: italic;">"trait"</span>, <span style="font-style: italic;">"question"</span>), sep = 2, convert = <span style="font-weight: bold; text-decoration: underline;">TRUE</span>)
</pre>
</div>

</div>
</div>
</li>

<li><a id="orgd3ebf4b"></a>Calculate scores for each <code>trait/user_id</code> combination<br />
<div class="outline-text-5" id="text-orgd3ebf4b">
<p>
Now calculate trait scores for each <code>user_id</code> and <code>trait</code> by summing the scores.  Store the result in <code>big5_scores</code>.
</p>

<div class='solution'><button>Solution</button>

<div class="org-src-container">
<pre class="src src-R">big5_long2 <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  group_by(user_id, trait) <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  summarise(tot = sum(score, na.rm = <span style="font-weight: bold; text-decoration: underline;">FALSE</span>), .groups = <span style="font-style: italic;">"drop"</span>)
</pre>
</div>

<pre class="example">

# A tibble: 75,000 x 3
   user_id trait   tot
     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
 1       0 Ag       NA
 2       0 Co       27
 3       0 Ex       25
 4       0 Ne       NA
 5       0 Op       20
 6       1 Ag       18
 7       1 Co       30
 8       1 Ex       24
 9       1 Ne       18
10       1 Op       30
# … with 74,990 more rows
</pre>

</div>
</div>
</li>

<li><a id="org9205e92"></a>EXTRA: string all the above commands in a single pipeline<br />
<div class="outline-text-5" id="text-org9205e92">

<div class='solution'><button>Solution</button>

<div class="org-src-container">
<pre class="src src-R">big5 <span style="font-weight: bold; text-decoration: underline;">&lt;-</span> read_csv(<span style="font-style: italic;">"personality.csv"</span>) <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  pivot_longer(Op1:Ex9,
               names_to = <span style="font-style: italic;">"item"</span>, values_to = <span style="font-style: italic;">"score"</span>) <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  separate(item, c(<span style="font-style: italic;">"trait"</span>, <span style="font-style: italic;">"question"</span>), sep = 2, convert = <span style="font-weight: bold; text-decoration: underline;">TRUE</span>) <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  group_by(user_id, trait) <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  summarise(tot = sum(score, na.rm = <span style="font-weight: bold; text-decoration: underline;">FALSE</span>), .groups = <span style="font-style: italic;">"drop"</span>)

big5
</pre>
</div>

<pre class="example">


── Column specification ────────────────────────────────────────────────────────
cols(
  .default = col_double(),
  date = col_date(format = "")
)
ℹ Use `spec()` for the full column specifications.

# A tibble: 75,000 x 3
   user_id trait   tot
     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
 1       0 Ag       NA
 2       0 Co       27
 3       0 Ex       25
 4       0 Ne       NA
 5       0 Op       20
 6       1 Ag       18
 7       1 Co       30
 8       1 Ex       24
 9       1 Ne       18
10       1 Op       30
# … with 74,990 more rows
</pre>


</div>
</div>
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org6c1eb23" class="outline-2">
<h2 id="org6c1eb23">Combining information across tables: <code>dplyr</code> two-table verbs</h2>
<div class="outline-text-2" id="text-org6c1eb23">
<p>
If you follow the principles of tidy data, you will end up with information scattered across different tables, since you&rsquo;ll have independent tables for each unit of observation. Often you will need to combine information from multiple tables. How do you put it back together? You do this using the various join functions from the <code>dplyr</code> package.
</p>

<p>
There are two main types of join functions: <i>mutating</i> joins and <i>filtering</i> joins, called thus because their functions are analogous to what <code>mutate()</code> and <code>filter()</code> do for single tables.
</p>

<p>
Mutating joins connect the information in two tables through linking variables or <i>keys</i> that identify which rows go together. 
</p>

<p>
Filtering joins allow you to decide which rows to keep or remove in one table based on the rows available in another table.  In the interest of time, we won&rsquo;t be covering filtering joins (<code>semi_join()</code> and <code>anti_join()</code>).
</p>
</div>

<div id="outline-container-org4337fac" class="outline-3">
<h3 id="org4337fac">Mutating joins</h3>
<div class="outline-text-3" id="text-org4337fac">
<p>
The two main mutating joins you should know about are <code>inner_join()</code> and <code>left_join()</code>.
</p>
</div>

<div id="outline-container-orge06a762" class="outline-4">
<h4 id="orge06a762"><code>inner_join()</code></h4>
<div class="outline-text-4" id="text-orge06a762">
<p>
A common situation where you might want to use an inner join is when you want to look up values in a <i>lookup table.</i>   For instance, consider the situation where you have numerical scores for an exam and want to convert them to alphanumeric grades.  My university, the University of Glasgow, uses a 22 point scale that looks like this:
</p>

<table id="org9453b11" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">score</th>
<th scope="col" class="org-left">mark</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">22</td>
<td class="org-left">A1</td>
</tr>

<tr>
<td class="org-right">21</td>
<td class="org-left">A2</td>
</tr>

<tr>
<td class="org-right">20</td>
<td class="org-left">A3</td>
</tr>

<tr>
<td class="org-right">19</td>
<td class="org-left">A4</td>
</tr>

<tr>
<td class="org-right">18</td>
<td class="org-left">A5</td>
</tr>

<tr>
<td class="org-right">17</td>
<td class="org-left">B1</td>
</tr>

<tr>
<td class="org-right">16</td>
<td class="org-left">B2</td>
</tr>

<tr>
<td class="org-right">15</td>
<td class="org-left">B3</td>
</tr>

<tr>
<td class="org-right">14</td>
<td class="org-left">C1</td>
</tr>

<tr>
<td class="org-right">13</td>
<td class="org-left">C2</td>
</tr>

<tr>
<td class="org-right">12</td>
<td class="org-left">C3</td>
</tr>

<tr>
<td class="org-right">11</td>
<td class="org-left">D1</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left">D2</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-left">D3</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-left">E1</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">E2</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-left">E3</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">F1</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">F2</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">F3</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">G1</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">G2</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-left">H</td>
</tr>
</tbody>
</table>

<p>
Let&rsquo;s say this is stored in the variable <code>mscale</code>. You also have a table of scores called <code>exam</code> like the one below, and you want to assign each 0-22 score the <code>mark</code> that appears in <code>mscale</code>. 
</p>

<pre class="example">

# A tibble: 10 x 2
   student_id score
   &lt;chr&gt;      &lt;int&gt;
 1 1276172       18
 2 2973679       14
 3 6655424        0
 4 5770670       22
 5 4547353        4
 6 4286501       10
 7 4053604       20
 8 8675541       12
 9 3653681       20
10 8984571       23
</pre>

<p>
So student <code class="src src-R">sids[1]</code> <code>[1] "1276172"</code> who got an 18 should be given an A5, the student who got a 14 should get a C1, etc. You could do this by hand, but it would be tedious and error-prone. What you could do instead would be to join the two tables on the <i>key</i> field of <code>score</code>, like so:
</p>

<div class="org-src-container">
<pre class="src src-R">result <span style="font-weight: bold; text-decoration: underline;">&lt;-</span> inner_join(exam, mscale, <span style="font-style: italic;">"score"</span>)
result
</pre>
</div>

<pre class="example">

# A tibble: 9 x 3
  student_id score mark 
  &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;
1 1276172       18 A5   
2 2973679       14 C1   
3 6655424        0 H    
4 5770670       22 A1   
5 4547353        4 F2   
6 4286501       10 D2   
7 4053604       20 A3   
8 8675541       12 C3   
9 3653681       20 A3
</pre>
</div>
</div>

<div id="outline-container-orgec93d8e" class="outline-4">
<h4 id="orgec93d8e"><code>left_join()</code></h4>
<div class="outline-text-4" id="text-orgec93d8e">
<p>
Note that the one student who had an <code>23</code> for their score (error? extra credit?) got thrown out from the result table.  A <code>left_join(x, y)</code> keeps all of the data in table <code>x</code> even if it lacks a match in table <code>y</code>, and the missing variable values get filled in with <code>NAs</code>.  Compare this result to the one above.
</p>

<div class="org-src-container">
<pre class="src src-R">left_join(exam, mscale, <span style="font-style: italic;">"score"</span>)
</pre>
</div>

<pre class="example">
# A tibble: 10 x 3
   student_id score mark 
   &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;
 1 1276172       18 A5   
 2 2973679       14 C1   
 3 6655424        0 H    
 4 5770670       22 A1   
 5 4547353        4 F2   
 6 4286501       10 D2   
 7 4053604       20 A3   
 8 8675541       12 C3   
 9 3653681       20 A3   
10 8984571       23 &lt;NA&gt;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgca987b0" class="outline-2">
<h2 id="orgca987b0"></h2>
<div class="outline-text-2" id="text-orgca987b0">
<script>

/* update total correct if #total_correct exists */
update_total_correct = function() {
  if (t = document.getElementById("total_correct")) {
    t.innerHTML =
      document.getElementsByClassName("correct").length + " of " +
      document.getElementsByClassName("solveme").length + " correct";
  }
}

/* solution button toggling function */
b_func = function() {
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "");
  }

  if (my_answer !== "" & real_answers.includes(my_answer)) {
    cl.add("correct");
  } else {
    cl.remove("correct");
  }
  update_total_correct();
}

window.onload = function() {
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up solveme inputs */
  var solveme = document.getElementsByClassName("solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off"); 
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }

  update_total_correct();
}

</script>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2021-04-06 Tue 20:54</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
