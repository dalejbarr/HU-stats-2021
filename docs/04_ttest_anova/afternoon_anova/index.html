<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-04-10 Sat 08:52 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Analysis of Variance</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../../css/my_css.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../../index.html"> UP </a>
 |
 <a accesskey="H" href="../../index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Analysis of Variance</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org20abc36">Doing ANOVA in R</a></li>
<li><a href="#org4dff147">One-factor ANOVA</a>
<ul>
<li><a href="#org5615162">Background</a></li>
<li><a href="#org9e24a13">Worked example</a></li>
</ul>
</li>
<li><a href="#org42d91eb">One-way ANOVA &ldquo;by-hand&rdquo;</a>
<ul>
<li><a href="#org2cc5396">Recreate decomposition matrix from the raw data</a>
<ul>
<li><a href="#org95e4cec">Step 1: Create tibble</a></li>
<li><a href="#org1cbd112">Step 2: Estimate \(\mu\)</a></li>
<li><a href="#org466b6e4">Step 3: Enter the estimates \(\hat{A}_1\), \(\hat{A}_2\), \(\hat{A}_3\)</a></li>
<li><a href="#orge319047">Step 4: Calculate \(\hat{e}_{ij}\)s</a></li>
<li><a href="#orgf5c820e">Step 5: Sums of squares</a></li>
<li><a href="#orgf5fa715">Final step: Calculate \(F\) statistics</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org6a7284e"></a></li>
</ul>
</div>
</div>

<div id="outline-container-org20abc36" class="outline-2">
<h2 id="org20abc36">Doing ANOVA in R</h2>
<div class="outline-text-2" id="text-org20abc36">
<p>
There are three ways to perform analysis of variance (ANOVA) in R.
</p>

<ol class="org-ol">
<li><code>base::aov()</code>;</li>
<li><code>car::Anova()</code>; and</li>
<li><code>ez::ezANOVA()</code>.</li>
</ol>

<p>
(Note <code>xxx::yyy()</code> syntax means the function <code>yyy()</code> in package <code>xxx</code>; <code>base</code> is just base R, i.e., the function comes pre-installed with R so to use the function you don&rsquo;t have to load in any packages.)
</p>

<p>
If you have balanced data, the factors are uncorrelated (e.g. due to random assignment), and none of your within-subject factors has more that 2 levels, you can use <code>aov()</code>.
</p>

<p>
If your goal is to replicate the output from SPSS, then your best bet is to use <code>ez::ezANOVA()</code>, because it provides Greenhouse-Geiser correction in case you have more than three levels of a within-subject factor, and handles unbalanced data more easily.
</p>

<p>
If your goal is to learn a flexible way of analysis that can accommodate all different types of data, forget about ANOVA and learn about mixed-effects modeling.  Just to get this off my chest, here are four reasons why you don&rsquo;t really want to use ANOVA with psychological data:
</p>

<ol class="org-ol">
<li>Doesn&rsquo;t adequately handle more than one random factor at a time,
and therefore, cannot properly generalize over both subjects and
stimuli;</li>
<li>Dealing with unbalanced data can be complicated;</li>
<li>Requires that your dependent variable is continuous, and therefore
is not ideal for discrete scale data or binary data;</li>
<li>Difficult to deal with continuous predictors.</li>
</ol>

<p>
If you have complicated designs and need follow-up tests, there is a newer package, <code>afex</code> that might be worth looking into. See <a href="http://singmann.org/anova-in-r-afex-may-be-the-solution-you-are-looking-for/">this blogpost by <code>afex</code> author Henrik Singmann</a> on the functionality of <code>afex</code>.  To quote Singmann:
</p>

<blockquote>
<p>
In the default settings, afex automatically uses appropriate orthogonal contrasts for factors, transforms numerical variables into factors, uses so-called Type III sums of squares, and allows for any number of factors including repeated-measures (or within-subjects) factors and mixed/split-plot designs. Together this guarantees that the ANOVA results correspond to the results obtained from commercial statistical packages such as SPSS or SAS.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org4dff147" class="outline-2">
<h2 id="org4dff147">One-factor ANOVA</h2>
<div class="outline-text-2" id="text-org4dff147">
</div>
<div id="outline-container-org5615162" class="outline-3">
<h3 id="org5615162">Background</h3>
<div class="outline-text-3" id="text-org5615162">
<p>
A key way that we attempt to learn from data is to build a <b>statistical model</b> that captures relationships among variables.  If you want to learn more about one-factor ANOVA as a kind of a General Linear Model (GLM), check out this free PDF textbook by <a href="https://www.otago.ac.nz/psychology/otago039309.pdf">Miller and Haden (2006)</a> (Chs. 1-3).
</p>
</div>
</div>

<div id="outline-container-org9e24a13" class="outline-3">
<h3 id="org9e24a13">Worked example</h3>
<div class="outline-text-3" id="text-org9e24a13">
<p>
Let&rsquo;s assume that you have data from a one-factor design with three-levels. To make this example concrete, let&rsquo;s pretend you are studying how consuming food before an exam affects student performance.  You randomly assign 12 participants to three separate groups (four per group): (1) no food, glass of water only (Control); (2) all-you-can-eat buffet (Buffet); and (3) side salad (Salad). (We chose a small number of participants to simplify computations so that you could repeat the analysis ; obviously if you were going to do this study in real life, you&rsquo;d need <b>far more</b> than 12 participants to make this worthwhile). For your dependent variable, you measure the number of questions answered correctly on an a difficult exam (100 points possible). The exam is administered right after consuming the meal (or drinking water, for the control group).
</p>

<p>
This is called a <b>one-factor design</b> because there is a single factor, which we might call &ldquo;pre-exam consumption&rdquo;, that has three different levels: water, buffet, and salad. We want to test whether there is any difference in exam performance across the levels of this factor.
</p>

<p>
Here&rsquo;s how the exam performance looks for each of the three groups:
</p>

<ul class="org-ul">
<li>Control: <code>37, 51, 64, 80</code></li>
<li>Buffet: <code>55, 33, 41, 47</code></li>
<li>Salad: <code>50, 48, 46, 48</code></li>
</ul>

<p>
The GLM that we will fit to these data is:
</p>

<p>
\(Y_{ij} = \mu + A_i + e_{ij}\)
</p>

<p>
Where:
</p>

<ul class="org-ul">
<li>\(Y_{ij}\) is the observed value for observation \(j\) of group \(i\);</li>
<li>\(\mu\) (pronounced &ldquo;mu&rdquo;) is the population grand mean (estimated by the sample grand mean);</li>
<li>\(A_i\) is the deviation of the population mean of group \(i\) from this grand mean;</li>
<li>\(e_{ij}\) is the error or &ldquo;residual&rdquo;, defined as the observed value (\(Y_{ij}\)) minus the model prediction (\(\hat{Y}_{ij}\)).</li>
</ul>

<p>
We will use <code>ezANOVA()</code> from the <code>ez</code> package to perform a one-way ANOVA. Let&rsquo;s first type our data into a tibble.  Make it look like the table below (Hint: Use the <code>rep()</code> to save typing; see <code>?rep</code> for examples)
</p>

<pre class="example">
Registered S3 methods overwritten by 'lme4':
  method                          from
  cooks.distance.influence.merMod car 
  influence.merMod                car 
  dfbeta.influence.merMod         car 
  dfbetas.influence.merMod        car

    Y  A sub_id
1  37 A1      1
2  51 A1      2
3  64 A1      3
4  80 A1      4
5  55 A2      5
6  33 A2      6
7  41 A2      7
8  47 A2      8
9  50 A3      9
10 48 A3     10
11 46 A3     11
12 48 A3     12
</pre>


<div class='solution'><button>Solution</button>

<pre class="example">

dat &lt;- tibble(Y = c(37, 51, 64, 80, 55, 33, 41, 47, 50, 48, 46, 48),
              A = rep(c("A1", "A2", "A3"), each = 4),
              sub_id = 1:12)
</pre>



</div>

<p>
Now look at the help page for <code>ez::ezANOVA()</code> and try to figure out how to run the ANOVA. 
</p>

<div class="org-src-container">
<pre class="src src-R">?ez::ezANOVA
</pre>
</div>

<pre class="example">
ezANOVA                   package:ez                   R Documentation

Compute ANOVA

Description:

     This function provides easy analysis of data from factorial
     experiments, including purely within-Ss designs (a.k.a. “repeated
     measures”), purely between-Ss designs, and mixed
     within-and-between-Ss designs, yielding ANOVA results, generalized
     effect sizes and assumption checks.

Usage:

     ezANOVA(
         data
         , dv
         , wid
         , within = NULL
         , within_full = NULL
         , within_covariates = NULL
         , between = NULL
         , between_covariates = NULL
         , observed = NULL
         , diff = NULL
         , reverse_diff = FALSE
         , type = 2
         , white.adjust = FALSE
         , detailed = FALSE
         , return_aov = FALSE
     )

Arguments:

    data: Data frame containing the data to be analyzed.

      dv: Name of the column in ‘data’ that contains the dependent
          variable. Values in this column must be numeric.

     wid: Name of the column in ‘data’ that contains the variable
          specifying the case/Ss identifier. This should be a unique
          value per case/Ss.

  within: Names of columns in ‘data’ that contain predictor variables
          that are manipulated (or observed) within-Ss. If a single
          value, may be specified by name alone; if multiple values,
          must be specified as a .() list.

within_full: Same as within, but intended to specify the full within-Ss
          design in cases where the data have not already been
          collapsed to means per condition specified by ‘within’ and
          when ‘within’ only specifies a subset of the full design.

within_covariates: Names of columns in ‘data’ that contain predictor
          variables that are manipulated (or observed) within-Ss and
          are to serve as covariates in the analysis. If a single
          value, may be specified by name alone; if multiple values,
          must be specified as a .() list.

 between: Names of columns in ‘data’ that contain predictor variables
          that are manipulated (or observed) between-Ss. If a single
          value, may be specified by name alone; if multiple values,
          must be specified as a .() list.

between_covariates: Names of columns in ‘data’ that contain predictor
          variables that are manipulated (or observed) between-Ss and
          are to serve as covariates in the analysis. If a single
          value, may be specified by name alone; if multiple values,
          must be specified as a .() list.

observed: Names of columns in ‘data’ that are already specified in
          either ‘within’ or ‘between’ that contain predictor variables
          that are observed variables (i.e. not manipulated). If a
          single value, may be specified by name alone; if multiple
          values, must be specified as a .() list. The presence of
          observed variables affects the computation of the generalized
          eta-squared measure of effect size reported by ‘ezANOVA’.

    diff: Names of any variables to collapse to a difference score. If
          a single value, may be specified by name alone; if multiple
          values, must be specified as a .() list. All supplied
          variables must be factors, ideally with only two levels
          (especially if setting the ‘reverse_diff’ argument to TRUE).

reverse_diff: Logical. If TRUE, triggers reversal of the difference
          collapse requested by ‘diff’. Take care with variables with
          more than 2 levels.

    type: Numeric value (either ‘1’, ‘2’ or ‘3’) specifying the Sums of
          Squares “type” to employ when data are unbalanced (eg. when
          group sizes differ). ‘type = 2’ is the default because this
          will yield identical ANOVA results as ‘type = 1’ when data
          are balanced but ‘type = 2’ will additionally yield various
          assumption tests where appropriate. When data are unbalanced,
          users are warned that they should give special consideration
          to the value of ‘type’. ‘type=3’ will emulate the approach
          taken by popular commercial statistics packages like SAS and
          SPSS, but users are warned that this approach is not without
          criticism.

white.adjust: Only affects behaviour if the design contains only
          between-Ss predictor variables. If not FALSE, the value is
          passed as the white.adjust argument to ‘Anova’, which
          provides heteroscedasticity correction. See ‘Anova’ for
          details on possible values.

detailed: Logical. If TRUE, returns extra information (sums of squares
          columns, intercept row, etc.) in the ANOVA table.

return_aov: Logical. If TRUE, computes and returns an aov object
          corresponding to the requested ANOVA (useful for computing
          post-hoc contrasts).

Details:

     ANCOVA is implemented by first regressing the DV against each
     covariate (after collapsing the data to the means of that
     covariate's levels per subject) and subtracting from the raw data
     the fitted values from this regression (then adding back the mean
     to maintain scale). These regressions are computed across Ss in
     the case of between-Ss covariates and computed within each Ss in
     the case of within-Ss covariates.

Value:

     A list containing one or more of the following components:

   ANOVA: A data frame containing the ANOVA results.

Mauchly's Test for Sphericity: If any within-Ss variables with &gt;2
          levels are present, a data frame containing the results of
          Mauchly's test for Sphericity. Only reported for effects &gt;2
          levels because sphericity necessarily holds for effects with
          only 2 levels.

Sphericity Corrections: If any within-Ss variables are present, a data
          frame containing the Greenhouse-Geisser and Huynh-Feldt
          epsilon values, and corresponding corrected p-values.

Levene's Test for Homogeneity: If the design is purely between-Ss, a
          data frame containing the results of Levene's test for
          Homogeneity of variance. Note that Huynh-Feldt corrected
          p-values where the Huynh-Feldt epsilon &gt;1 will use 1 as the
          correction epsilon.

     aov: An aov object corresponding to the requested ANOVA.
     Some column names in the output data frames are abbreviated to
     conserve space:

       DFn         Degrees of Freedom in the numerator (a.k.a. DFeffect).                                                                
       DFd         Degrees of Freedom in the denominator (a.k.a. DFerror).                                                               
       SSn         Sum of Squares in the numerator (a.k.a. SSeffect).                                                                    
       SSd         Sum of Squares in the denominator (a.k.a. SSerror).                                                                   
       F           F-value.                                                                                                              
       p           p-value (probability of the data given the null hypothesis).                                                          
       p&lt;.05       Highlights p-values less than the traditional alpha level of .05.                                                     
       ges         Generalized Eta-Squared measure of effect size (see in references below: Bakeman, 2005).                              
       GGe         Greenhouse-Geisser epsilon.                                                                                           
       p[GGe]      p-value after correction using Greenhouse-Geisser epsilon.                                                            
       p[GGe]&lt;.05  Highlights p-values (after correction using Greenhouse-Geisser epsilon) less than the traditional alpha level of .05. 
       HFe         Huynh-Feldt epsilon.                                                                                                  
       p[HFe]      p-value after correction using Huynh-Feldt epsilon.                                                                   
       p[HFe]&lt;.05  Highlights p-values (after correction using Huynh-Feldt epsilon) less than the traditional alpha level of .05.        
       W           Mauchly's W statistic                                                                                                 

Warning:

     Prior to running (though after obtaining running ANCOVA
     regressions as described in the ‘details’ section), ‘dv’ is
     collapsed to a mean for each cell defined by the combination of
     ‘wid’ and any variables supplied to ‘within’ and/or ‘between’
     and/or ‘diff’. Users are warned that while convenient when used
     properly, this automatic collapsing can lead to inconsistencies if
     the pre-collapsed data are unbalanced (with respect to cells in
     the full design) and only the partial design is supplied to
     ‘ezANOVA’. When this is the case, use ‘within_full’ to specify the
     full design to ensure proper automatic collapsing.

Author(s):

     Michael A. Lawrence &lt;email: mike.lwrnc@gmail.com&gt;
     Visit the ‘ez’ development site at &lt;
     http://github.com/mike-lawrence/ez&gt;
     for the bug/issue tracker and the link to the mailing list.
</pre>

<p>
Your results should look like so:
</p>

<pre class="example">
Warning: Converting "sub_id" to factor for ANOVA.
Warning: Converting "A" to factor for ANOVA.
Coefficient covariances computed by hccm()
$ANOVA
  Effect DFn DFd SSn  SSd        F         p p&lt;.05       ges
1      A   2   9 416 1278 1.464789 0.2813705       0.2455726

$`Levene's Test for Homogeneity of Variance`
  DFn DFd      SSn SSd        F          p p&lt;.05
1   2   9 338.6667 295 5.166102 0.03204979     *
</pre>


<div class='solution'><button>Solution</button>

<div class="org-src-container">
<pre class="src src-R">ezANOVA(dat, Y, wid = .(sub_id), between = .(A), detailed = <span style="font-weight: bold; text-decoration: underline;">TRUE</span>)
</pre>
</div>


</div>
</div>
</div>
</div>


<div id="outline-container-org42d91eb" class="outline-2">
<h2 id="org42d91eb">One-way ANOVA &ldquo;by-hand&rdquo;</h2>
<div class="outline-text-2" id="text-org42d91eb">
<p>
A great way to understand the elements of ANOVA is to do one &ldquo;by hand&rdquo;. In the old days this would mean doing it with pencil and paper; here we&rsquo;re going to do it by writing code. We&rsquo;ll revisit the data from the <a href="#org9e24a13">one-factor example above</a>.  For convenience, let&rsquo;s repeat the data here:
</p>

<ul class="org-ul">
<li>Control: <code>37, 51, 64, 80</code></li>
<li>Buffet: <code>55, 33, 41, 47</code></li>
<li>Salad: <code>50, 48, 46, 48</code></li>
</ul>

<p>
If you wish to learn more about the concepts of <b>estimation equations</b>, <b>decomposition matrices</b>, and <b>sums of squares</b>, you can find further information in <a href="https://www.otago.ac.nz/psychology/otago039309.pdf">this free textbook by Miller and Haden</a>.
</p>

<p>
We begin by applying estimation equations.  Our estimate of the population grand mean \(\mu\), will be based on the grand mean of the sample.  We will call this \(\hat{\mu}\). The &ldquo;hat&rdquo; that \(\mu\) is wearing (\(\hat{\mu}\)) is just there to remind us that it is not the actual population mean, but an <b>estimate</b> of that value derived from our sample.
</p>

<p>
The estimation equations for our model are:
</p>

<p>
\(\hat{\mu} = Y_{..}\)
</p>

<p>
\(\hat{A}_i = Y_{i.} - \hat{\mu}\)
</p>

<p>
\(\hat{e}_{ij} = Y_{ij} - (\hat{\mu} + \hat{A}_i) = Y_{ij} - \hat{\mu} - \hat{A}_i\)
</p>

<p>
where
</p>

<ul class="org-ul">
<li>\(Y_{..}\) is the mean of all 12 observations in the sample;</li>
<li>\(Y_{i.}\) is the mean of the 4 observations in group \(i\);</li>
<li>\(\hat{A}_i\) is the main effect of \(A\) for level \(i\), and</li>
<li>\(\hat{e}_{ij}\) is the residual.</li>
</ul>

<p>
Applying these estimation equations to the data above yields the following decomposition matrix:
</p>

<pre class="example">

   i j Yij mu Ai err
1  1 1  37 50  8 -21
2  1 2  51 50  8  -7
3  1 3  64 50  8   6
4  1 4  80 50  8  22
5  2 1  55 50 -6  11
6  2 2  33 50 -6 -11
7  2 3  41 50 -6  -3
8  2 4  47 50 -6   3
9  3 1  50 50 -2   2
10 3 2  48 50 -2   0
11 3 3  46 50 -2  -2
12 3 4  48 50 -2   0
</pre>

<p>
Note that in this table, <code>mu</code> is \(\hat{\mu}\), <code>Ai</code> is \(\hat{A}_i\), and <code>err</code> is \(\hat{e}_{ij}\).  Take a few moments to understand how this table expresses each of the 12 observed values in our example (the \(Y_{ij}\) values) in terms of the linear model \(Y_{ij} = \mu + A_i + e_{ij}\).
</p>
</div>

<div id="outline-container-org2cc5396" class="outline-3">
<h3 id="org2cc5396">Recreate decomposition matrix from the raw data</h3>
<div class="outline-text-3" id="text-org2cc5396">
<p>
For this part, your task is to reproduce the tibble shown above, reproduced here:
</p>

<pre class="example">
   i j Yij mu Ai err
1  1 1  37 50  8 -21
2  1 2  51 50  8  -7
3  1 3  64 50  8   6
4  1 4  80 50  8  22
5  2 1  55 50 -6  11
6  2 2  33 50 -6 -11
7  2 3  41 50 -6  -3
8  2 4  47 50 -6   3
9  3 1  50 50 -2   2
10 3 2  48 50 -2   0
11 3 3  46 50 -2  -2
12 3 4  48 50 -2   0
</pre>

<p>
You will do this by typing the observed values into a tibble, and then writing code to add columns with estimates of the individual components (feel free to copy the code you already wrote above). At the end, your table should look exactly like the one above.
</p>

<p>
You already know how to create a tibble (don&rsquo;t forget to load the tidyverse package first). In case you need to refresh your memory, see [page 2 of this cheatsheet on data input in R](<a href="https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf">https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf</a>).
</p>
</div>

<div id="outline-container-org95e4cec" class="outline-4">
<h4 id="org95e4cec">Step 1: Create tibble</h4>
<div class="outline-text-4" id="text-org95e4cec">
<p>
Create a tibble named <code>dmx</code> (for decomposition matrix). It will eventually contain all of the columns in the one above, but for now, just create the columns <code>i</code>, <code>j</code>, and <code>Yij</code>. You should just type in the values for <code>Yij</code>.
</p>


<div class='solution'><button>Hint 1</button>

<p>
<code>dmx &lt;- tibble(i = NA, j = NA, Yij = NA)</code>
</p>


</div>




<div class='solution'><button>Hint 2</button>

<p>
<code>rep(1:3, each = 4)</code>
</p>


</div>



<div class='solution'><button>Solution</button>

<div class="org-src-container">
<pre class="src src-R"><span style="font-weight: bold; text-decoration: underline;">library</span>(<span style="font-style: italic;">"tidyverse"</span>)

dmx <span style="font-weight: bold; text-decoration: underline;">&lt;-</span> tibble(i = rep(1:3, each = 4), 
              j = rep(1:4, times = 3),
              Yij = c(37, 80, 64, 51,
                    33, 47, 55, 41,
                    59, 23, 50, 60)) <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">TYPE THE VALUES</span>
</pre>
</div>


</div>
</div>
</div>


<div id="outline-container-org1cbd112" class="outline-4">
<h4 id="org1cbd112">Step 2: Estimate \(\mu\)</h4>
<div class="outline-text-4" id="text-org1cbd112">
<p>
Add a column to the table, called <code>mu</code> representing \(\hat{\mu}\).  Call the resulting table <code>dmx2</code>.  Remember that you can add a column to a table using <code>mutate()</code>.
</p>


<div class='solution'><button>Hint 1</button>

<pre class="example">
dmx2 &lt;- dmx %&gt;% 
   mutate(mu = ???)
</pre>



</div>




<div class='solution'><button>Solution</button>

<div class="org-src-container">
<pre class="src src-R">dmx2 <span style="font-weight: bold; text-decoration: underline;">&lt;-</span> dmx <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  mutate(mu = mean(Yij))
</pre>
</div>


</div>
</div>
</div>



<div id="outline-container-org466b6e4" class="outline-4">
<h4 id="org466b6e4">Step 3: Enter the estimates \(\hat{A}_1\), \(\hat{A}_2\), \(\hat{A}_3\)</h4>
<div class="outline-text-4" id="text-org466b6e4">
<p>
Add a column to the table <code>dmx2</code> called <code>Ai</code>, with the three estimates for \(\hat{A}_i\).  Store the resulting tibble in <code>dmx3</code>.
</p>


<div class='solution'><button>Hint</button>

<ul class="org-ul">
<li>don&rsquo;t forget to <code>ungroup()</code> at the end of the pipeline</li>
</ul>


</div>




<div class='solution'><button>Solution</button>

<div class="org-src-container">
<pre class="src src-R">dmx3 <span style="font-weight: bold; text-decoration: underline;">&lt;-</span> dmx2 <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  group_by(i) <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">calculate different values for each i</span>
  mutate(Ai = mean(Yij) - mu) <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  ungroup()
</pre>
</div>


</div>
</div>
</div>



<div id="outline-container-orge319047" class="outline-4">
<h4 id="orge319047">Step 4: Calculate \(\hat{e}_{ij}\)s</h4>
<div class="outline-text-4" id="text-orge319047">
<p>
Now add a column <code>err</code> to <code>dmx3</code> and store the result in <code>dmx4</code>. The column <code>err</code> should contain the residuals (the difference between the observed and fitted values)
</p>


<div class='solution'><button>Hint</button>

<p>
\(\hat{e}_{ij} = Y_{ij} - \hat{Y}_{ij}\)
</p>

<p>
\(\hat{Y}_{ij} = \hat{\mu} + \hat{A}_i\) 
</p>


</div>




<div class='solution'><button>Solution</button>

<div class="org-src-container">
<pre class="src src-R">dmx4 <span style="font-weight: bold; text-decoration: underline;">&lt;-</span> dmx3 <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  mutate(err = Yij - (mu + Ai))

dmx4
</pre>
</div>

<pre class="example">

   i j Yij mu Ai err
1  1 1  37 50  8 -21
2  1 2  80 50  8  22
3  1 3  64 50  8   6
4  1 4  51 50  8  -7
5  2 1  33 50 -6 -11
6  2 2  47 50 -6   3
7  2 3  55 50 -6  11
8  2 4  41 50 -6  -3
9  3 1  59 50 -2  11
10 3 2  23 50 -2 -25
11 3 3  50 50 -2   2
12 3 4  60 50 -2  12
</pre>


</div>



<p>
Display <code>dmx4</code> in the console and compare it to the table above.  How did you do?
</p>
</div>
</div>

<div id="outline-container-orgf5c820e" class="outline-4">
<h4 id="orgf5c820e">Step 5: Sums of squares</h4>
<div class="outline-text-4" id="text-orgf5c820e">
<p>
Sums of squares are used in calculations for performing tests on model components.
</p>

<p>
Square the values in the columns <code>Yij</code>, <code>mu</code>, <code>Ai</code>, and <code>err</code> in <code>dmx4</code>, then sum up the squared values for each of these columns.  Here is an example of how you would square a value <code>x</code> in R: <code>x^2</code>.  The <code>^2</code> means take x to the power of 2.  So typing <code>3^2</code> in the console will give you <code>9</code> (try it if you&rsquo;re unsure).
</p>


<div class='solution'><button>Hint 1</button>

<pre class="example">
dmx4 %&gt;% mutate(Yij2 = Yij^2, ...)
</pre>



</div>




<div class='solution'><button>Hint 2</button>

<pre class="example">
summarise(ss_Y = sum(Yij2), ss_mu = ...)
</pre>



</div>




<div class='solution'><button>Solution</button>

<div class="org-src-container">
<pre class="src src-R">sstbl <span style="font-weight: bold; text-decoration: underline;">&lt;-</span> dmx4 <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  mutate(Yij2 = Yij^2,
         mu2 = mu^2,
         Ai2 = Ai^2,
         err2 = err^2) <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  select(Yij2, mu2, Ai2, err2) <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  summarise(ss_Y = sum(Yij2),
            ss_mu = sum(mu2),
            ss_Ai = sum(Ai2),
            ss_err = sum(err2))

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">here is a super cool way to do the same thing,</span>
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">using dplyr's "scoping" technique </span>
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">(see ?dplyr::scoped and ?dplyr::summarise_all)</span>
sstbl <span style="font-weight: bold; text-decoration: underline;">&lt;-</span> dmx4 <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  select(Yij:err) <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span>
  summarise_all(funs(sum(.^2)))

sstbl
</pre>
</div>

<pre class="example">

Warning message:
`funs()` was deprecated in dplyr 0.8.0.
Please use a list of either functions or lambdas: 

  # Simple named list: 
  list(mean = mean, median = median)

  # Auto named with `tibble::lst()`: 
  tibble::lst(mean, median)

  # Using lambdas
  list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
[90mThis warning is displayed once every 8 hours.[39m
[90mCall `lifecycle::last_warnings()` to see where this warning was generated.[39m

    Yij    mu  Ai  err
1 32580 30000 416 2164
</pre>


</div>
</div>
</div>

<div id="outline-container-orgf5fa715" class="outline-4">
<h4 id="orgf5fa715">Final step: Calculate \(F\) statistics</h4>
<div class="outline-text-4" id="text-orgf5fa715">
<p>
\(F = \frac{MS_{A}}{MS_{err}}\)
</p>

<p>
\(MS_A = \frac{MS_A}{df_A}\)
</p>

<p>
\(MS_{err} = \frac{MS_{err}}{df_{err}}\)
</p>

<p>
Get the p-value using the appropriate probability distribution for the \(F\) distribution (Hint: remember <code>dnorm()</code>, <code>pnorm()</code>, and <code>qnorm()</code>?)
</p>

<p>
Your results should <b>exactly</b> reproduce the ones we got from <code>ezANOVA()</code>.
</p>


<div class='solution'><button>Hint (F function)</button>

<p>
<code>?pf</code>
</p>


</div>


<div class='solution'><button>Solution</button>

<div class="org-src-container">
<pre class="src src-R">ms_a <span style="font-weight: bold; text-decoration: underline;">&lt;-</span> (sstbl <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span> pull(Ai)) / 2L <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">2 dfs</span>
ms_err <span style="font-weight: bold; text-decoration: underline;">&lt;-</span> (sstbl <span style="font-weight: bold; text-decoration: underline;">%&gt;%</span> pull(err)) / 9L <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">9 dfs</span>

f_ratio <span style="font-weight: bold; text-decoration: underline;">&lt;-</span> ms_a / ms_err
p_value <span style="font-weight: bold; text-decoration: underline;">&lt;-</span> pf(f_ratio, 2, 9, lower.tail = <span style="font-weight: bold; text-decoration: underline;">FALSE</span>)

cat(<span style="font-style: italic;">"F(2, 9) ="</span>, round(f_ratio, 2), <span style="font-style: italic;">", p ="</span>, round(p_value, 3), <span style="font-style: italic;">"\n"</span>)
</pre>
</div>

<pre class="example">

F(2, 9) = 0.87 , p = 0.453
</pre>



</div>
</div>
</div>
</div>
</div>


<div id="outline-container-org6a7284e" class="outline-2">
<h2 id="org6a7284e"></h2>
<div class="outline-text-2" id="text-org6a7284e">
<script>

/* update total correct if #total_correct exists */
update_total_correct = function() {
  if (t = document.getElementById("total_correct")) {
    t.innerHTML =
      document.getElementsByClassName("correct").length + " of " +
      document.getElementsByClassName("solveme").length + " correct";
  }
}

/* solution button toggling function */
b_func = function() {
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "");
  }

  if (my_answer !== "" & real_answers.includes(my_answer)) {
    cl.add("correct");
  } else {
    cl.remove("correct");
  }
  update_total_correct();
}

window.onload = function() {
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up solveme inputs */
  var solveme = document.getElementsByClassName("solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off"); 
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }

  update_total_correct();
}

</script>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2021-04-10 Sat 08:52</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
